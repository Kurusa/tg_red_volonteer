<?php

namespace App\Commands;

use App\Models\Request;
use App\Services\RequestModeService;
use App\Services\UserKeyboardService;
use App\Services\UserModeService;
use CURLFile;

class Start extends BaseCommand {

    function processCommand($par = false)
    {
            $text = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π –î—Ä—É–≥!üëãüèº

üîÖ–¢–µ–±—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ë–æ—Ç –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ–±—Ä–æ–≤–æ–ª–µ—Ü–µ–≤ –Ω–∞ –¥–æ–º, –†–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ö—Ä–∞—Å–Ω–æ–≥–æ –ö—Ä–µ—Å—Ç–∞‚ÄºÔ∏è

‚ùóÔ∏è–ë–æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π  –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–µ–≤ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø–æ –±–æ—Ä—å–±–µ —Å —Ä–∞–º–ø—Ä–æ–º—Ç—Ä–æ–Ω–µ–Ω–∏–µ–º COVID-19‚ùóÔ∏è

–ú—ã –æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–º–æ—â—å –ø–æ–∂–∏–ª—ã–º –ª—é–¥—è–º, –æ–∫–∞–∑–∞–≤—à–∏—Ö—Å—è –≤ —Å–∏—Ç—É–∞—Ü–∏–∏ –ñ–ï–°–¢–ö–û–ô —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏.üè°
–ë–æ—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ—Å–ø–ª–∞—Ç–µ–Ω –∏ –Ω–µ –ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç –∫–∞–∫–æ–π-–ª–∏–±–æ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –≤—ã–≥–æ–¥—ã.üôÖüèº‚Äç‚ôÇÔ∏è


–ü–æ –≤—Å–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Éüë®üèº‚Äçüíª @horanq';

        if ($this->tg_parser::getMessage() == '–¥–æ—Å—Ç–∞–≤—â–∏–∫' || $this->user->mode !== UserModeService::WAITING) {
            $this->user->mode = UserModeService::DONE;
            $this->user->request_id = 0;
            $this->user->save();

            Request::where('operator_id', $this->user->id)->where('mode', RequestModeService::FILLING)->delete();

            $keyboard = UserKeyboardService::KEYBOARD_DATA[$this->user->type];
            $this->tg->sendPhotoCaption(new CURLFile($_SERVER['DOCUMENT_ROOT'] . '/app/start.jpg'), $par ?: $text);
            $this->tg->sendMessageWithKeyboard('–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', [$keyboard]);
        } else {
            if ($this->user->mode == UserModeService::WAITING) {
                if ($this->tg_parser::getMessage() == '–∫—É—Ä—å–µ—Ä') {
                    $this->user->mode = UserModeService::DONE;
                    $this->user->request_id = 0;
                    $this->user->save();

                    Request::where('operator_id', $this->user->id)->where('mode', RequestModeService::FILLING)->delete();

                    $keyboard = UserKeyboardService::KEYBOARD_DATA[$this->user->type];
                    $this->tg->sendPhotoCaption(new CURLFile($_SERVER['DOCUMENT_ROOT'] . '/app/start.jpg'), $par ?: $text, [$keyboard]);
                    exit;
                }
                $this->tg->sendPhotoCaption(new CURLFile($_SERVER['DOCUMENT_ROOT'] . '/app/start.jpg'), '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π –î—Ä—É–≥!üëãüèº

üîÖ–¢–µ–±—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ë–æ—Ç –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ–±—Ä–æ–≤–æ–ª–µ—Ü–µ–≤ –Ω–∞ –¥–æ–º, –†–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ö—Ä–∞—Å–Ω–æ–≥–æ –ö—Ä–µ—Å—Ç–∞‚ÄºÔ∏è

‚ùóÔ∏è–ë–æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —É—Å–ø–µ—à–Ω–æ–π  –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–µ–≤ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø–æ –±–æ—Ä—å–±–µ —Å —Ä–∞–º–ø—Ä–æ–º—Ç—Ä–æ–Ω–µ–Ω–∏–µ–º COVID-19‚ùóÔ∏è

–ú—ã –æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–º–æ—â—å –ø–æ–∂–∏–ª—ã–º –ª—é–¥—è–º, –æ–∫–∞–∑–∞–≤—à–∏—Ö—Å—è –≤ —Å–∏—Ç—É–∞—Ü–∏–∏ –ñ–ï–°–¢–ö–û–ô —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏.üè°
–ë–æ—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ—Å–ø–ª–∞—Ç–µ–Ω –∏ –Ω–µ –ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç –∫–∞–∫–æ–π-–ª–∏–±–æ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –≤—ã–≥–æ–¥—ã.üôÖüèº‚Äç‚ôÇÔ∏è


–ü–æ –≤—Å–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Éüë®üèº‚Äçüíª @horanq');
                $this->tg->sendMessageWithKeyboard('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –≤—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–∞

‚õë–ê) –ï—Å–ª–∏ —Ç—ã –î–æ–±—Ä–æ–≤–æ–ª–µ—Ü - –ö—É—Ä—å–µ—Ä, –≤—ã–±–µ—Ä–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≥—Ä—É–ø–ø—É –∏ –º–æ–∂–µ—à—å –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —Ä–∞–±–æ—Ç–µ

‚õë–ë) –ï—Å–ª–∏ —Ç—ã –î–æ–±—Ä–æ–≤–æ–ª–µ—Ü - –û–ø–µ—Ä–∞—Ç–æ—Ä Call —Ü–µ–Ω—Ç—Ä–∞, –≤—ã–±–µ—Ä–∏ –≥—Ä—É–ø–ø—É –∏ –¥–æ–∂–¥–∏—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º', [
                    ['–∫—É—Ä—å–µ—Ä'], ['–æ–ø–µ—Ä–∞—Ç–æ—Ä']
                ]);
                exit;
            }
        }
    }

}